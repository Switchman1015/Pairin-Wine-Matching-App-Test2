<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>Pairin 診断｜あなたに合うワインを提案</title>
  <meta name="theme-color" content="#0b0b10" />
  <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><circle cx="8" cy="8" r="8" fill="%23ff6b8b"/></svg>' />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0b10; --muted:#c7cedb; --ink:#f8f9fc;
      --accent:#FFB56B; --accent-2:#FF6B8B; --radius:22px;
      --shadow:0 10px 24px rgba(0,0,0,.30), 0 2px 10px rgba(0,0,0,.18);
      --bg-image:url('pairin_title_bg.jpg');
    }
    *,*::before,*::after{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; padding:0; color:var(--ink); background: var(--bg); overflow:hidden; -webkit-text-size-adjust:100%; overscroll-behavior:none; touch-action:none; }
    *::-webkit-scrollbar{ display:none; } *{ -ms-overflow-style:none; scrollbar-width:none; }

    .stage{ position:fixed; inset:0; width:100vw; height:100svh; display:grid; place-items:center; background-image: var(--bg-image); background-size: cover; background-position:center; isolation:isolate; }
    .card{ width:min(94vw, 560px); margin:0; border-radius:var(--radius);
           background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0) 28%), linear-gradient(135deg, #221a28 0%, #1a1e2a 100%);
           box-shadow: 0 0 0 1px rgba(255,107,139,.18), var(--shadow);
           padding:24px 20px; display:flex; flex-direction:column; gap:14px; align-items:stretch; }
    .card::before{ content:""; position:absolute; inset:0; border-radius:inherit; pointer-events:none; }

    .header{ display:flex; align-items:center; gap:12px; }
    .logo{ width:48px; height:48px; border-radius:12px; }
    .title{ font-family:'Playfair Display', serif; font-size: clamp(22px, 4vw, 28px); margin:0; }
    .subtitle{ color:var(--muted); margin:2px 0 10px; font-size:14px; }

    .step{ display:flex; flex-direction:column; gap:14px; align-items:center; }
    .qtext{ margin:6px 2px 0; font-size: clamp(16px, 4.5vw, 18px); font-weight:700; text-align:center; }

    .swipe{ position:relative; width:min(92vw, 520px); height:min(56vh, 280px); max-height:320px; display:grid; place-items:center; touch-action:none; }
    .card-face{ position:relative; width:100%; height:100%; border-radius:18px; overflow:hidden; background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0) 28%), linear-gradient(135deg, #241c2b 0%, #1a1e2a 100%); box-shadow: 0 0 0 1px rgba(255,107,139,.18), var(--shadow); padding:16px; transition: transform .16s ease; will-change: transform; }
    .tint{ position:absolute; inset:0; pointer-events:none; opacity:0; transition: opacity .06s linear; }
    .tint.left{ background: linear-gradient(90deg, rgba(255,181,107,.55), rgba(255,181,107,0)); }
    .tint.right{ background: linear-gradient(270deg, rgba(255,107,139,.55), rgba(255,107,139,0)); }
    .choice{ position:absolute; top:50%; transform: translateY(-50%) scale(.94); padding:10px 14px; border-radius:12px; font-weight:900; font-size: clamp(16px, 5vw, 22px); letter-spacing:.02em; color:#fffaf7; text-shadow: 0 2px 10px rgba(0,0,0,.35); opacity:.5; user-select:none; pointer-events:none; }
    .choice.left{ left:14px; border:1px solid rgba(255,181,107,.45); background: rgba(255,181,107,.14); }
    .choice.right{ right:14px; border:1px solid rgba(255,107,139,.45); background: rgba(255,107,139,.14); }
    .hint{ position:absolute; bottom:10px; left:0; right:0; text-align:center; font-size:12px; color:var(--muted); opacity:.85; }

    .meta{ display:flex; justify-content:space-between; align-items:center; color:var(--muted); font-size:12px; margin-top:2px; }
    .progress{ height:6px; background: rgba(255,255,255,.10); border-radius:999px; overflow:hidden; }
    .bar{ height:100%; width:0%; background: linear-gradient(90deg, var(--accent), var(--accent-2)); }

    .actions{ display:flex; gap:10px; margin-top:8px; }
    .btn{ flex:1; appearance:none; border:0; border-radius:999px; padding:14px 18px; font-weight:800; letter-spacing:.04em; color:#0b1320; background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%); box-shadow: 0 6px 18px rgba(255,107,139,.28), 0 2px 10px rgba(0,0,0,.25); cursor:pointer; }
    .btn.secondary{ background: rgba(255,255,255,.08); color:#fff; box-shadow:none; border:1px solid rgba(255,255,255,.14); }

    .result{ display:none; margin-top:6px; padding:16px; border-radius:14px; background: rgba(0,0,0,.25); border:1px solid rgba(255,255,255,.12); }
    .result h2{ margin:0 0 8px; font-size:20px; }
    .tips{ color:var(--muted); font-size:14px; margin:8px 0 0; }
  </style>
</head>
<body class="noselect">
  <main class="stage">
    <section class="card" role="group" aria-label="ワイン診断">
      <div class="header">
        <img class="logo" src="pairin_logo.png" alt="Pairin ロゴ" />
        <div>
          <h1 class="title">ワイン診断</h1>
          <p class="subtitle">2択の質問に順番に答えてください（全5問）。</p>
        </div>
      </div>

      <div class="meta">
        <span id="stepText">1 / 5</span>
        <a href="index.html" style="color:var(--muted); text-decoration:none;">タイトルへ</a>
      </div>
      <div class="progress" aria-hidden="true"><div class="bar" id="bar"></div></div>

      <div id="step" class="step" role="group" aria-live="polite"></div>

      <div class="result" id="result" role="region" aria-live="polite">
        <h2 id="resultTitle">結果</h2>
        <div id="resultBody"></div>
        <p class="tips" id="resultTips"></p>
        <div class="actions" style="margin-top:12px;">
          <button class="btn" type="button" id="retry" aria-label="もう一度診断する">もう一度</button>
          <button class="btn secondary" type="button" id="toHome" aria-label="タイトルへ戻る">タイトルへ</button>
        </div>
      </div>
    </section>
  </main>

  <script>
    // Disable zoom/scroll gestures per app policy
    (function(){
      const block = (e)=>{ e.preventDefault(); e.stopPropagation(); return false; };
      ['gesturestart','gesturechange','gestureend','dblclick'].forEach(ev=>{ window.addEventListener(ev, block, {passive:false}); });
      window.addEventListener('wheel', (e)=>{ if(e.ctrlKey || e.metaKey){ block(e); } }, {passive:false});
      window.addEventListener('touchmove', block, {passive:false});
      window.addEventListener('scroll', ()=>{ window.scrollTo(0,0); }, {passive:true});
    })();

    const $ = (sel) => document.querySelector(sel);
    const stepEl = $('#step');
    const bar = $('#bar');
    const stepText = $('#stepText');
    const result = $('#result');
    const titleEl = $('#resultTitle');
    const bodyEl = $('#resultBody');
    const tipsEl = $('#resultTips');

    $('#toHome').addEventListener('click', ()=>{ window.location.href = 'index.html'; });
    $('#retry').addEventListener('click', ()=>{ result.style.display = 'none'; current=0; scores = { red:0, white:0, rose:0, sparkling:0 }; render(); });

    const questions = [
      { key:'body', text:'好みの味わいは？', a:{ label:'軽やか', score:{ white:2, rose:1, sparkling:2 } }, b:{ label:'コクがある', score:{ red:3 } } },
      { key:'food', text:'合わせたい料理は？', a:{ label:'肉料理', score:{ red:3 } }, b:{ label:'魚料理', score:{ white:3, rose:1 } } },
      { key:'temp', text:'飲むときの温度は？', a:{ label:'冷やして', score:{ white:2, rose:2 } }, b:{ label:'常温で', score:{ red:2 } } },
      { key:'scene', text:'シーンは？', a:{ label:'カジュアル', score:{ white:1, rose:1 } }, b:{ label:'お祝い', score:{ sparkling:3 } } },
      { key:'price', text:'価格帯は？', a:{ label:'カジュアル', score:{ white:1, rose:1 } }, b:{ label:'リッチ', score:{ red:1, sparkling:1 } } }
    ];

    function describe(type){
      switch(type){
        case 'red': return { title:'あなたにおすすめは「赤ワイン」', body:'しっかりめの味わいが好みで、肉料理との相性を重視するあなたには赤ワイン。品種ならカベルネ・ソーヴィニヨンやシラー、もう少し軽めならピノ・ノワールも。', tips:'サーロインや煮込み料理、熟成チーズと好相性。16〜18℃で。' };
        case 'white': return { title:'あなたにおすすめは「白ワイン」', body:'爽やかな飲み口や料理に寄り添う万能さを求めるあなたには白。ソーヴィニヨン・ブランやシャルドネ、和食にはリースリングも好相性。', tips:'魚介や野菜、和食全般に。8〜12℃で冷やして。' };
        case 'rose': return { title:'あなたにおすすめは「ロゼ」', body:'白の飲みやすさと赤のコクの良いとこ取り。チーズやアジアン、アウトドアの食事にも寄り添う万能タイプ。', tips:'軽い肉料理や魚、スパイス料理と。8〜12℃で。' };
        default: return { title:'あなたにおすすめは「スパークリング」', body:'お祝いの席やよく冷えた一杯を楽しみたいあなたに。シャンパーニュ方式の辛口や、カジュアルならプロセッコも。', tips:'前菜から食後まで幅広く。5〜8℃でしっかり冷やして。' };
      }
    }

    let current = 0;
    let scores = { red:0, white:0, rose:0, sparkling:0 };

    function applyScore(delta){
      for(const k in delta){ scores[k] += delta[k]; }
    }

    function render(){
      if(current >= questions.length){
        const best = Object.entries(scores).sort((a,b)=> b[1]-a[1])[0][0];
        const d = describe(best);
        titleEl.textContent = d.title;
        bodyEl.textContent = d.body;
        tipsEl.textContent = d.tips;
        stepEl.style.display = 'none';
        result.style.display = 'block';
        bar.style.width = '100%';
        stepText.textContent = `${questions.length} / ${questions.length}`;
        return;
      }
      result.style.display = 'none';
      stepEl.style.display = 'flex';
      const q = questions[current];
      stepEl.innerHTML = `
        <div class="qtext">${current+1}. ${q.text}</div>
        <div class="swipe" id="swipe" aria-label="左右にスワイプして選択">
          <div class="card-face" id="card">
            <div class="tint left" id="tintL"></div>
            <div class="tint right" id="tintR"></div>
            <div class="choice left" id="choiceL">${q.a.label}</div>
            <div class="choice right" id="choiceR">${q.b.label}</div>
            <div class="hint">スワイプで選択</div>
          </div>
        </div>
      `;
      stepText.textContent = `${current+1} / ${questions.length}`;
      bar.style.width = `${Math.round((current)/questions.length*100)}%`;

      const swipe = document.getElementById('swipe');
      const card = document.getElementById('card');
      const tintL = document.getElementById('tintL');
      const tintR = document.getElementById('tintR');
      const choiceL = document.getElementById('choiceL');
      const choiceR = document.getElementById('choiceR');

      let startX = 0, dx = 0, dragging = false, pointerId = null;
      const THRESH = 80;
      function setVisuals(){
        const p = Math.min(1, Math.abs(dx)/THRESH);
        if(dx < 0){
          tintL.style.opacity = String(0.2 + 0.6*p);
          tintR.style.opacity = '0';
          choiceL.style.opacity = String(0.6 + 0.4*p);
          choiceL.style.transform = `translateY(-50%) scale(${(0.94 + 0.12*p).toFixed(3)})`;
          choiceR.style.opacity = '0.35';
          choiceR.style.transform = 'translateY(-50%) scale(0.94)';
        }else if(dx > 0){
          tintR.style.opacity = String(0.2 + 0.6*p);
          tintL.style.opacity = '0';
          choiceR.style.opacity = String(0.6 + 0.4*p);
          choiceR.style.transform = `translateY(-50%) scale(${(0.94 + 0.12*p).toFixed(3)})`;
          choiceL.style.opacity = '0.35';
          choiceL.style.transform = 'translateY(-50%) scale(0.94)';
        }else{
          tintL.style.opacity = '0';
          tintR.style.opacity = '0';
          choiceL.style.opacity = '0.5';
          choiceR.style.opacity = '0.5';
          choiceL.style.transform = 'translateY(-50%) scale(0.94)';
          choiceR.style.transform = 'translateY(-50%) scale(0.94)';
        }
      }
      function setTransform(anim){
        const rot = Math.max(-12, Math.min(12, dx*0.06));
        if(anim){ card.style.transition = 'transform .16s ease'; } else { card.style.transition = 'none'; }
        card.style.transform = `translateX(${dx}px) rotate(${rot}deg)`;
        setVisuals();
      }
      function release(){
        if(Math.abs(dx) >= THRESH){
          const which = dx > 0 ? 'b' : 'a';
          const exitX = dx > 0 ? window.innerWidth * 0.6 + 200 : -(window.innerWidth * 0.6 + 200);
          card.style.transition = 'transform .22s ease-out';
          card.style.transform = `translateX(${exitX}px) rotate(${dx>0?12:-12}deg)`;
          setTimeout(()=>{
            const delta = which === 'a' ? q.a.score : q.b.score;
            applyScore(delta);
            current += 1;
            render();
          }, 200);
        }else{
          dx = 0; setTransform(true);
        }
        dragging = false; pointerId = null;
      }
      swipe.addEventListener('pointerdown', (e)=>{
        dragging = true; pointerId = e.pointerId; swipe.setPointerCapture(pointerId); startX = e.clientX; dx = 0; setTransform(false);
      });
      swipe.addEventListener('pointermove', (e)=>{
        if(!dragging) return; dx = e.clientX - startX; setTransform(false);
      });
      swipe.addEventListener('pointerup', release);
      swipe.addEventListener('pointercancel', release);
    }

    render();
  </script>
</body>
</html>
